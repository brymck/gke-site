def keyToSchemeMap = ['HTTP_PROXY': 'http', 'HTTPS_PROXY': 'https']
def env = System.getenv()
keyToSchemeMap.each { key, scheme ->
    if (key in env) {
        def url = env[key].toURL()
        println "${scheme}.proxyHost=${url.host}"
        System.setProperty("${scheme}.proxyHost", url.host.toString())
        println "${scheme}.proxyPort=${url.port}"
        System.setProperty("${scheme}.proxyPort", url.port.toString())
        if (url.userInfo) {
            println "${scheme}.proxyUser=********"
            def (user, password) = url.userInfo.split(':')
            System.setProperty("${scheme}.proxyUser", user.toString())
            if (password) {
                println "${scheme}.proxyPassword=********"
                System.setProperty("${scheme}.proxyPassword", password.toString())
            }
        }
    }
}
